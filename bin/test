#!/usr/bin/env bash
# -*- bash -*-
#
#
first_opt="$1"
set -u -e -o pipefail

if [[ "$first_opt" == "help" ]]; then

  echo ""
  echo "  # == examples: =="
  echo "  bin/test    # -> ruby tests"
  echo "  bin/test js # -> javascript tests"
  echo "  # ==============="
  exit 0
fi

if [[ "$first_opt" == "all" ]]; then
  bin/test
  bin/test js
  exit 0
fi

if [[ "$first_opt" == "js" ]]; then
  shift
  files="$(find specs/as_javascript -maxdepth 1 -type f -iname "*.js" -and -not -iname "helpers.js")"
  if [[ -z "$files" ]]; then
    colorize yellow "No tests found." 1>&2
    exit 0
  else
    mocha -R spec $files "$@"
  fi
  exit 0
fi

files="$(find specs/as_ruby -maxdepth 1 -type f -iname "*.rb" -and -not -iname "helpers.rb")"
if [[ -z "$files" ]]; then
  colorize yellow "No tests found." 1>&2
  exit 0
else
  bundle exec bacon specs/as_ruby/helpers.rb $files "$@"
fi
